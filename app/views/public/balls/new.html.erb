<div class="container mt-5">
  <div class="row main-row">
    <div class="col-12">

      <div class="form-row">
        <div class="form-group col-1"></div>
        <h4 class="form-group col-4">
          <span class="text-under-line">
            ボールレビュー新規投稿
          </span>
        </h4>
      </div>

      <div class="form-row mt-3">
        <div class="form-group col-1"></div>
        <div class="form-group col">
          <%= render "layouts/errors", obj: @ball %>
        </div>
      </div>

      <%= form_with model: @ball, url: balls_path do |f| %>

        <div class="form-row">
          <div class="form-group col-1"></div>
          <span class="form-group col-2"><%= f.label :ボール名 %></span>
          <div class="form-group col-3">
            <%= f.text_field :ball_name, class: "form-control" %>
          </div>
        </div>

        <div class="form-row mt-3">
          <div class="form-group col-1"></div>
          <span class="form-group col-2"><%= f.label :メーカー名 %></span>
          <div class="form-group col-3">
            <%= f.text_field :maker, class: "form-control" %>
          </div>
        </div>

        <div class="form-row mt-3">
          <div class="form-group col-1"></div>
          <span class="form-group col-2"><%= f.label :レビュー内容 %></span>
          <div class="form-group col-6">
            <%= f.text_area :caption, class: "form-control", rows: 4 %>
          </div>
        </div>

        <div class="form-row mt-3">
          <div class="form-group col-1"></div>
          <span class="form-group col-2"><%= f.label :ボール画像 %></span>
          <div class="form-group col-6">
            <%= f.file_field :ball_image, accept: "image/*" %>
          </div>
        </div>

        <% if @ball.id.nil? %>
          <div class="form-row mt-3">
            <div class="form-group col-1"></div>
            <span class="form-group col-2" id="star"><%= f.label :ボール評価 %></span>
            <div class="form-group col-6">
              <%= f.hidden_field :ball_rate, id: :review_star, class: 'form-control' %>
              <div id="post_raty"></div>
              <script>
                $(document).on('turbolinks:load', function() {
                  let elem = document.querySelector('#post_raty');
                  if (elem == null) return;

                  elem.innerHTML = "";
                  let opt = {
                    starOn: "<%= asset_path('star-on.png') %>",
                    starOff: "<%= asset_path('star-off.png') %>",
                    starHalf: "<%= asset_path('star-half.png') %>",
                    scoreName: 'ball[rate]',
                  };
                  raty(elem, opt);
                });
              </script>
            </div>
          </div>
        <% else %>
          <div class="form-row mt-3">
            <div class="form-group col-1"></div>
            <div class="form-group col-6">
              <div id="rate_<%= @ball.id %>"></div>
              <script>
                $(document).on('turbolinks:load', function() {
                  let elem = document.querySelector('#rate_<%= @ball.id %>');
                  if (elem == null) return;

                  elem.innerHTML = "";
                  let opt = {
                    starOn: "<%= asset_path('star-on.png') %>",
                    starOff: "<%= asset_path('star-off.png') %>",
                    starHalf: "<%= asset_path('star-half.png') %>",
                    score: "<%= @ball.rate %>",
                    readOnly: true,
                  };
                  raty(elem, opt);
                });
              </script>
            </div>
          </div>
        <% end %>

        <div class="form-row">
          <div class="form-group col-3"></div>
          <div class="form-group col">
            <%= f.submit "投稿する", class: "btn btn-success col-3" %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>